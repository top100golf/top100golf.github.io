---
title: "Top 100 courses by state"
---

<br>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(lubridate)
library(gridExtra)
library(png)
source("/Users/skipperry/Documents/golf_course_rankings/plot_rankings.R")
source("/Users/skipperry/Documents/golf_course_rankings/course_categories.R")
```

```{r}
current_rankings <- 
  all_rankings %>% 
  group_by(Publication) %>% 
  filter(Year == max(Year)) %>% 
  ungroup() %>% 
  select(Ranking, Course, Publication) %>% 
  spread(Publication, Ranking) %>% 
  mutate(Average = (`Golf Digest` + `Golf Magazine`) / 2) %>% 
  inner_join(course_info, by = "Course") %>% 
  mutate(
    Designer1 = if_else(Designer1 == "Robert Trent Jones", "Robert Trent Jones Sr.", Designer1),
    Designer2 = if_else(Designer2 == "Robert Trent Jones", "Robert Trent Jones Sr.", Designer2),
    Designer3 = if_else(Designer3 == "Robert Trent Jones", "Robert Trent Jones Sr.", Designer3)
  ) %>% 
  transmute(
    Course, Location = str_c(City, ", ", State), 
    Designers = case_when(
      is.na(Designer2) ~ Designer1,
      is.na(Designer3) ~ str_c(Designer1, Designer2, sep = ", "),
      TRUE ~ str_c(Designer1, Designer2, Designer3, sep = ", ")
    ),
    `Year Designed` = Year_Designed, `Golf Digest`, `Golf Magazine`, Average,
    Top_Rating = case_when(
      is.na(`Golf Digest`) | `Golf Digest` > `Golf Magazine` ~ `Golf Magazine`,
      TRUE ~ `Golf Digest`
    )
  ) %>% 
  arrange(Average, Top_Rating) %>% 
  select(-Top_Rating) %>% 
  rename(`Golf Digest Current` = `Golf Digest`, `Golf Magazine Current` = `Golf Magazine`,
         `Average Current` = `Average`)

best_rankings <- 
  all_rankings %>% 
  group_by(Course, Publication) %>% 
  filter(Ranking == min(Ranking)) %>% 
  slice(1) %>% 
  ungroup() %>% 
  select(Ranking, Course, Publication) %>% 
  spread(Publication, Ranking) %>% 
  mutate(Average = (`Golf Digest` + `Golf Magazine`) / 2) %>% 
  inner_join(course_info, by = "Course") %>% 
  mutate(
    Designer1 = if_else(Designer1 == "Robert Trent Jones", "Robert Trent Jones Sr.", Designer1),
    Designer2 = if_else(Designer2 == "Robert Trent Jones", "Robert Trent Jones Sr.", Designer2),
    Designer3 = if_else(Designer3 == "Robert Trent Jones", "Robert Trent Jones Sr.", Designer3)
  )  %>% 
  transmute(
    Course, Location = str_c(City, ", ", State), 
    Designers = case_when(
      is.na(Designer2) ~ Designer1,
      is.na(Designer3) ~ str_c(Designer1, Designer2, sep = ", "),
      TRUE ~ str_c(Designer1, Designer2, Designer3, sep = ", ")
    ),
    `Year Designed` = Year_Designed, `Golf Digest`, `Golf Magazine`, Average,
    Top_Rating = case_when(
      is.na(`Golf Digest`) | `Golf Digest` > `Golf Magazine` ~ `Golf Magazine`,
      TRUE ~ `Golf Digest`
    )
  ) %>% 
  arrange(Average, Top_Rating) %>% 
  select(-Top_Rating) %>% 
  rename(`Golf Digest Best` = `Golf Digest`, `Golf Magazine Best` = `Golf Magazine`,
         `Average Best` = `Average`)

course_listing_with_history <- 
  current_rankings %>% 
  full_join(best_rankings, by = c("Course", "Location", "Designers", "Year Designed")) %>% 
  mutate(across(where(is.numeric), ~ if_else(is.na(.), '-', as.character(.))))

state_df <- 
  tibble(state = state.name, state_abb = state.abb)
```

```{r}
state_total <- function(state_name) {
  course_listing_with_history %>% 
    filter(str_detect(Location, str_c(", ", state_df$state_abb[state_df$state == state_name]))) %>% 
    count() %>% 
    pull(n)
}
state_current <- function(state_name) {
  course_listing_with_history %>% 
    filter(str_detect(Location, str_c(", ", state_df$state_abb[state_df$state == state_name]))) %>% 
    filter(`Golf Digest Current` != "-" | `Golf Magazine Current` != "-") %>% 
    count() %>% 
    pull(n)
}
state_former <- function(state_name) {
  course_listing_with_history %>% 
    filter(str_detect(Location, str_c(", ", state_df$state_abb[state_df$state == state_name]))) %>% 
    filter(`Golf Digest Current` == "-" & `Golf Magazine Current` == "-") %>% 
    count() %>% 
    pull(n)
}
state_flag <- function(state_name) {
  str_c(
    "state_flags/", 
    state_df$state_abb[state_df$state == state_name], 
    ".png"
  ) %>% 
    knitr::include_graphics()
}
print_table_by_state <- function(state_name) {
  base_url <- "https://top100golf.github.io/"
  
  if (state_total(state_name) > 0) { 
    course_listing_with_history %>% 
      filter(str_detect(Location, str_c(", ", state_df$state_abb[state_df$state == state_name]))) %>% 
      select(-Designers, -contains("Average")) %>% 
      mutate(
        Course = str_c("[", Course, "](", base_url, str_replace_all(Course, "\\(|\\)|\\s|\\'", "-"), ".html)"),
        Location = str_remove(Location, ", \\w+")
      ) %>% 
      knitr::kable(align = "c")  
  }
}
```

```{r}
state_of_interest <- "Alabama"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Alaska"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Arizona"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Arkansas"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "California"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Colorado"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Connecticut"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Delaware"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Florida"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Georgia"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Hawaii"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Idaho"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Illinois"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Indiana"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Kansas"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Kentucky"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Louisiana"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Maine"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Maryland"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Massachusetts"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Michigan"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Minnesota"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Mississippi"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Missouri"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Montana"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Nebraska"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Nevada"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "New Hampshire"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "New Jersey"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "New Mexico"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "New York"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "North Carolina"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "North Dakota"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Ohio"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Oklahoma"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Oregon"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Pennsylvania"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Rhode Island"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "South Carolina"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "South Dakota"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Tennessee"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Texas"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Utah"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Vermont"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Virginia"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Washington"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "West Virginia"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Wisconsin"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```

<br>

```{r}
state_of_interest <- "Wyoming"
state_flag(state_of_interest)
```

### `r state_of_interest`
#### `r state_of_interest %>% state_total()` total (`r state_of_interest %>% state_current` current, `r state_of_interest %>% state_former` previous)

```{r}
print_table_by_state(state_of_interest)
```
